(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{3327:function(e,t,n){Promise.resolve().then(n.bind(n,1034))},1034:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var i=n(7437),l=n(2265),a=n(2050),s=n(6738),r=n(3429),d=n(4855),o=n(4719),c=n(5030),h=n(6347),x=n(1419),p=n(329),u=n(4273),m=n(9116),j=n(6346),g=n(7415),v=n(9122),y=n(9396),f=n(9503),Z=n(8793),b=n(3295),w=n(7590),k=n(3634),T=n(2448),C=n(9219),P=n(8767),S=n(5999),I=n(3969),z=n(3302),N=n(4815),_=n(3691),H=n(2105),A=n(5594),E=n(209),B=n(4032),D=n(8251),O=n(1167),q=n(6691),F=n.n(q);function L(e){let{open:t,onClose:n,userData:a,onSave:s}=e,[r,d]=(0,l.useState)(a||{username:"",name:"",email:"",password:"",role:[],department:"",status:!1}),[o,c]=(0,l.useState)(""),[p,j]=(0,l.useState)(""),g=e=>{let{name:t,value:n}=e.target;d({...r,[t]:n})},v=async e=>{if(e.target.files&&e.target.files[0]){let t=new FormData;console.log(e.target),t.append("source","ml"),t.append("folder","dtp"),t.append("api_key","922982469845971"),t.append("upload_preset","j7xlhzak"),t.append("file",e.target.files[0]),await fetch("https://api.cloudinary.com/v1_1/dt2vxc5jx/image/upload",{method:"POST",body:t}).then(async t=>{let n=await t.json();"image"===e.target.name&&(j(n.secure_url),c(e.target.files[0]),d({...r,image:n.secure_url}),console.log(p))})}},y=async e=>{let t=new FormData;t.append("public_id","i6tqxbeflpqszrmxqpat"),t.append("api_key","922982469845971"),Date.now(),await fetch("/api/image/signature").then(async e=>{let n=await e.json();t.append("timestamp",n.timestamp),t.append("signature",n.signature),await fetch("https://api.cloudinary.com/v1_1/dt2vxc5jx/image/destroy",{method:"POST",body:t}).then(async e=>{let t=await e.json();console.log(t)})})};return(0,i.jsx)(w.ZP,{open:t,onClose:()=>{n(),c(""),j("")},sx:{marginTop:"50px"},children:(0,i.jsxs)(k.Z,{"aria-labelledby":"user-edit-modal",layout:"center",children:[(0,i.jsx)(T.Z,{}),(0,i.jsx)(m.ZP,{id:"user-edit-modal",level:"h2",children:r.username?"Chỉnh sửa":"Th\xeam mới"}),(0,i.jsxs)("form",{style:{overflow:"scroll"},onSubmit:e=>{e.preventDefault(),s(r)},children:[(0,i.jsxs)(C.Z,{id:"username",children:[(0,i.jsx)(P.Z,{children:"Username"}),(0,i.jsx)(S.ZP,{name:"username",type:"text",placeholder:"username",value:r.username,required:!0,readOnly:!0})]}),(0,i.jsxs)(C.Z,{id:"email",children:[(0,i.jsx)(P.Z,{children:"Email"}),(0,i.jsx)(S.ZP,{name:"email",type:"email",placeholder:"email",value:r.email,required:!0,onChange:e=>{var t,n;return d({...r,email:null===(t=e.target)||void 0===t?void 0:t.value,username:null===(n=e.target)||void 0===n?void 0:n.value.split("@")[0]})}}),(0,i.jsx)(I.Z,{children:"Với email VNPT, v\xed dụ: abc@vnpt.vn"})]}),(0,i.jsxs)(C.Z,{id:"name",children:[(0,i.jsx)(P.Z,{children:" T\xean "}),(0,i.jsx)(S.ZP,{name:"name",type:"text",placeholder:"name",value:r.name,required:!0,onChange:g})]}),(0,i.jsxs)(C.Z,{children:[(0,i.jsx)(P.Z,{children:" Chức năng "}),(0,i.jsx)(x.Z,{variant:"outlined",sx:{width:360,p:2,borderRadius:"sm"},children:(0,i.jsx)("div",{role:"group","aria-labelledby":"rank",children:(0,i.jsx)(D.Z,{orientation:"horizontal",wrap:!0,sx:{"--List-gap":"8px","--ListItem-radius":"20px","--ListItem-minHeight":"32px"},children:["Admin","Trụ điện lực","Trụ BTS","Trụ VNPT"].map((e,t)=>(0,i.jsxs)(O.Z,{children:[r.role.includes(e)&&(0,i.jsx)(B.Z,{color:"primary",sx:{ml:-.5,mr:.5,zIndex:2,pointerEvents:"none"}}),(0,i.jsx)(u.Z,{size:"sm",disableIcon:!0,overlay:!0,label:e,checked:r.role.includes(e),variant:r.role.includes(e)?"soft":"outlined",onChange:t=>{t.target.checked?d({...r,role:[...r.role,e]}):d({...r,role:r.role.filter(t=>t!==e)})},slotProps:{action:e=>{let{checked:t}=e;return{sx:t?{border:"1px solid",borderColor:"primary.500"}:{}}}}})]},e))})})})]}),(0,i.jsxs)(C.Z,{id:"password",children:[(0,i.jsx)(P.Z,{children:"Mật khẩu"}),(0,i.jsx)(S.ZP,{name:"password",type:"password",placeholder:"password",required:!0,value:r.password,onChange:g})]}),(0,i.jsxs)(C.Z,{id:"image",children:[(0,i.jsx)(P.Z,{children:"Ảnh"}),(0,i.jsx)(S.ZP,{name:"image",type:"file",placeholder:"file",required:!0,value:o,disabled:""!==o,onChange:e=>v(e)}),r.image&&(0,i.jsxs)(z.Z,{component:"li",sx:{minWidth:300,minHeight:300,marginTop:"5px",flexGrow:1},children:[(0,i.jsx)(h.Z,{"aria-label":"bookmark Bahamas Islands",variant:"plain",color:"neutral",size:"sm",sx:{zIndex:2,position:"absolute",top:"0.875rem",right:"0.5rem"},onClick:y,children:(0,i.jsx)(E.Z,{})}),(0,i.jsx)(N.Z,{children:(0,i.jsx)(F(),{alt:"image",src:r.image,fill:!0,className:"rounded",loading:"lazy",objectFit:"contain"})})]})]}),(0,i.jsx)(C.Z,{id:"status",children:(0,i.jsxs)(P.Z,{children:["Trạng th\xe1i\xa0\xa0\xa0",(0,i.jsx)(_.Z,{checked:r.status,onChange:e=>d({...r,status:e.target.checked})})]})}),(0,i.jsxs)(C.Z,{id:"department",children:[(0,i.jsx)(P.Z,{children:" Đơn vị"}),(0,i.jsx)(H.Z,{defaultValue:r.department,placeholder:"Chọn đơn vị",name:"department",onChange:(e,t)=>{d({...r,department:t})},children:[{departmentId:"tpcl",departmentName:"Th\xe0nh phố Cao L\xe3nh"},{departmentId:"tpsd",departmentName:"Th\xe0nh phố Sa Đ\xe9c"},{departmentId:"tphn",departmentName:"Th\xe0nh phố Hồng Ngự"},{departmentId:"hcl",departmentName:"Huyện Cao L\xe3nh"},{departmentId:"tmi",departmentName:"Huyện Th\xe1p Mười "},{departmentId:"tbh",departmentName:"Huyện Thanh B\xecnh"}].map(e=>(0,i.jsx)(A.Z,{value:e.departmentId,children:e.departmentName}))})]}),(0,i.jsx)("br",{}),(0,i.jsx)(h.Z,{sx:{mt:1,alignSelf:"center"},type:"submit",children:"Lưu"})]})]})})}var V=n(797),K=n(2749);function R(){var e,t;let[n,w]=(0,l.useState)([]),[k,T]=(0,l.useState)([]),[C,P]=(0,l.useState)(!0),[S,I]=(0,l.useState)(!1),[z,N]=(0,l.useState)({});(0,l.useEffect)(()=>{_()},[]);let _=async()=>{let e=await fetch("/api/user/get"),t=await e.json();w(t.result||[]),P(!1)},H=async e=>{let t=await fetch("/api/user/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});await t.json(),_()},A=async e=>{let t=await fetch("/api/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});await t.json(),_()};function E(e){let{row:t}=e,[n,h]=(0,l.useState)(!1);return(0,i.jsxs)(a.L,{children:[(0,i.jsx)(s.Z,{slots:{root:r.ZP},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:(0,i.jsx)(b.Z,{})}),(0,i.jsxs)(d.Z,{size:"sm",sx:{minWidth:140},children:[(0,i.jsx)(o.Z,{onClick:()=>h(!0),children:"Chỉnh sửa"}),(0,i.jsx)(o.Z,{children:"Đổi mật khẩu"}),(0,i.jsx)(o.Z,{onClick:()=>{let e={...t,status:!t.status};H(e)},children:t.status?"Kh\xf3a":"K\xedch hoạt"}),(0,i.jsx)(c.Z,{}),(0,i.jsx)(o.Z,{color:"danger",children:"X\xf3a"})]}),(0,i.jsx)(L,{open:n,onClose:()=>h(!1),userData:t,onSave:H})]})}let{data:B,status:D}=(0,K.useSession)();return(console.log("session",B),!B||(null==B?void 0:null===(t=B.user)||void 0===t?void 0:null===(e=t.role)||void 0===e?void 0:e.includes("Admin")))?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(V.Z,{location:"T\xe0i khoản",children:(0,i.jsx)(h.Z,{onClick:()=>I(!0),startDecorator:(0,i.jsx)(y.Z,{}),children:"Th\xeam mới"})}),(0,i.jsx)(L,{open:S,onClose:()=>I(!1),userData:null,onSave:A}),(0,i.jsxs)(x.Z,{sx:{width:"100%",borderRadius:"sm",flexShrink:1,overflow:"auto",minHeight:0},variant:"outlined",children:[(0,i.jsxs)(p.Z,{"aria-labelledby":"tableTitle",stickyHeader:!0,hoverRow:!0,sx:{"--TableCell-headBackground":"var(--joy-palette-background-level1)","--Table-headerUnderlineThickness":"1px","--TableRow-hoverBackground":"var(--joy-palette-background-level1)","--TableCell-paddingY":"4px","--TableCell-paddingX":"8px"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{width:48,textAlign:"center",padding:"12px 6px"},children:(0,i.jsx)(u.Z,{size:"sm",indeterminate:k.length>0&&k.length!==n.length,checked:k.length===n.length,onChange:()=>{T(k.length===n.length?[]:n.map(e=>null==e?void 0:e.id))},color:k.length>0||k.length===n.length?"primary":void 0,sx:{verticalAlign:"text-bottom"}})}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"T\xean"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"T\xe0i khoản"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"Email"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"Đơn vị"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"Trạng th\xe1i"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:"Chức năng"}),(0,i.jsx)("th",{style:{width:140,padding:"12px 6px"},children:" "})]})}),(0,i.jsx)("tbody",{children:C||n&&(!n||0!==n.length)?n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{textAlign:"center",width:120},children:(0,i.jsx)(u.Z,{size:"sm",checked:k.includes(null==e?void 0:e.id),color:k.includes(null==e?void 0:e.id)?"primary":void 0,onChange:()=>T(k.includes(e.id)?k.filter(t=>t!==e.id):[...k,e.id]),slotProps:{checkbox:{sx:{textAlign:"left"}}},sx:{verticalAlign:"text-bottom"}})}),(0,i.jsx)("td",{children:(0,i.jsx)(m.ZP,{level:"body-xs",children:null==e?void 0:e.name})}),(0,i.jsx)("td",{children:(0,i.jsx)(m.ZP,{level:"body-xs",children:null==e?void 0:e.username})}),(0,i.jsx)("td",{children:(0,i.jsx)(m.ZP,{level:"body-xs",children:null==e?void 0:e.email})}),(0,i.jsx)("td",{children:(0,i.jsx)(m.ZP,{level:"body-xs",children:null==e?void 0:e.department})}),(0,i.jsx)("td",{children:(0,i.jsx)(j.Z,{variant:"soft",size:"sm",startDecorator:(null==e?void 0:e.status)?(0,i.jsx)(Z.Z,{}):(0,i.jsx)(f.Z,{}),color:(null==e?void 0:e.status)?"success":"danger",children:(null==e?void 0:e.status)?"Đ\xe3 k\xedch hoạt":"Kh\xf3a"})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{role:"group","aria-labelledby":"rank",children:["Admin","Trụ điện lực","Trụ BTS","Trụ VNPT"].map(t=>(0,i.jsx)(i.Fragment,{children:e.role.includes(t)&&(0,i.jsx)(j.Z,{variant:"soft",size:"sm",color:"primary",children:t})}))})}),(0,i.jsx)("td",{children:(0,i.jsx)(g.Z,{sx:{display:"flex",gap:2,alignItems:"center"},children:(0,i.jsx)(E,{row:e})})})]},e.id)):(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:8,style:{textAlign:"center"},children:"Kh\xf4ng c\xf3 dữ liệu"})},"nodata")})]}),C&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{variant:"text"}),(0,i.jsx)(v.Z,{variant:"text"})]})]})]}):(0,i.jsx)(i.Fragment,{children:"You are not permission!"})}},797:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var i=n(7437),l=n(2265),a=n(8019),s=n(1419),r=n(3429),d=n(2513),o=n(1311),c=n(5869),h=n(7028);function x(e){let{onClick:t,sx:n,...a}=e,{mode:s,setMode:d}=(0,o.tv)(),[x,p]=l.useState(!1);return(l.useEffect(()=>{p(!0)},[]),x)?(0,i.jsxs)(r.ZP,{id:"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...a,onClick:e=>{"light"===s?d("dark"):d("light"),null==t||t(e)},sx:[{"& > *:first-child":{display:"dark"===s?"none":"initial"},"& > *:last-child":{display:"light"===s?"none":"initial"}},...Array.isArray(n)?n:[n]],children:[(0,i.jsx)(c.Z,{}),(0,i.jsx)(h.Z,{})]}):(0,i.jsx)(r.ZP,{size:"sm",variant:"outlined",color:"neutral",...a,sx:n,disabled:!0})}var p=n(8886),u=n(7415),m=n(6957),j=n(274),g=n(3455),v=n(9677),y=n(9116),f=e=>{let{location:t,children:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsxs)(m.Z,{size:"sm","aria-label":"breadcrumbs",separator:(0,i.jsx)(j.Z,{}),children:[(0,i.jsx)(g.Z,{underline:"none",color:"neutral",href:"/","aria-label":"Home",children:(0,i.jsx)(v.Z,{})}),(0,i.jsx)(y.ZP,{color:"primary",fontWeight:500,fontSize:12,children:t})]}),(0,i.jsx)(x,{sx:{ml:"auto",display:{xs:"none",md:"inline-flex"}}})]}),(0,i.jsxs)(u.Z,{sx:{display:"flex",my:1,gap:1,flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"start",sm:"center"},flexWrap:"wrap",justifyContent:"space-between"},children:[(0,i.jsx)(y.ZP,{level:"h2",children:t}),n]}),(0,i.jsxs)(s.Z,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"space-between",position:"fixed",top:0,left:0,width:"100vw",height:"var(--Header-height)",zIndex:9995,p:2,gap:1,borderBottom:"1px solid",borderColor:"background.level1",boxShadow:"sm"},children:[(0,i.jsx)(a.Z,{styles:e=>({":root":{"--Header-height":"52px",[e.breakpoints.up("md")]:{"--Header-height":"0px"}}})}),(0,i.jsx)(r.ZP,{onClick:()=>(0,p.GB)(),variant:"outlined",color:"neutral",size:"sm",children:(0,i.jsx)(d.Z,{})}),(0,i.jsx)(x,{id:void 0})]})]})}},8886:function(e,t,n){"use strict";n.d(t,{GB:function(){return a},Xp:function(){return l},wJ:function(){return i}});let i=()=>{"undefined"!=typeof document&&(document.body.style.overflow="hidden",document.documentElement.style.setProperty("--SideNavigation-slideIn","1"))},l=()=>{"undefined"!=typeof document&&(document.documentElement.style.removeProperty("--SideNavigation-slideIn"),document.body.style.removeProperty("overflow"))},a=()=>{if("undefined"!=typeof document){let e=window.getComputedStyle(document.documentElement).getPropertyValue("--SideNavigation-slideIn");e?l():i()}}}},function(e){e.O(0,[511,843,793,749,42,285,691,542,610,971,864,744],function(){return e(e.s=3327)}),_N_E=e.O()}]);